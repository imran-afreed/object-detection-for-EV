Inorder to train a network on local PC, 

[This](https://github.com/IITBRacing/Object-Detection-20---21-DV/blob/master/training/train_local/TrainYolo_local.ipynb) notebook contains code do do all the below mentioned changes
You should just run all these cells in order and at the last cell training starts

## Cloning darknet :
  First clone and make darknet at any directory on your PC from
  ```
   git clone https://github.com/pjreddie/darknet
   cd darknet
   make
```
  Once thatâ€™s successful, To test the build we can download pre trained YOLO weights and perform detection with the test image.
  ```
  ./darknet detector test cfg/coco.data cfg/yolov3.cfg yolov3.weights data/dog.jpg
```

## Creating dataset :
   Create a dataset same as the one created for google colab, with pics and corresponding .txt annotation file.
   
   - create a directory darknet/data/obj and put all the images and .txt files in this directory
 
## Configuring :
   - Find darknet/cfg/yolov3.cfg file 
   - Copy and paste it in the same directory with the name yolov3-custom.cfg
### Editing yolov3-custom.cfg :
  ![](https://github.com/IITBRacing/Object-Detection-20---21-DV/blob/master/training/train_local/pics/1.jpg)
  
  Make sure that the Training is uncommented and testing is commented in the .cfg file
  and the subdivision is set to 16 by default and incase your machines runs out of memory or shows some error change it to 32.
  
  1. Go to line 20 and change max_batches to  2000*(#number_of_classes) but it should be atleast 4000 that is training for 1 and 2 classes max_batches = 4000, for 3 classes max_batches = 6000 
  2. Go to line 22 and change steps = 80%,90% of max_matches that is for 3 classes steps = 4800,5400
  3. We will need to update the classes and filters params of [yolo] and [convolutional] layers that are just before the           [yolo] layers.
  4. In this case since we have a three class (yellow, blue, orange) we will update the classes param in the [yolo] layers to 3 at line numbers: 610, 696, 783
  5. Similarly we will need to update the filters param based on the classes count filters=(classes + 5) * 3. For a three         classes we should set filters=24 at line numbers: 603, 689, 776
  
## Training :
  1. Create a file named obj.names in darknet/data folder and list your classes in the order as shown in the pic below
  ![](https://github.com/IITBRacing/Object-Detection-20---21-DV/blob/master/training/train_local/pics/2.png)
  
  2. Create a file named obj.data in the same directory, this file gives path for the required files as shown below
  ```
  classes = 3
  train = data/train.txt
  valid = data/test.txt
  names = data/obj.names
  backup = backup/
  ```
  3. train.txt contain path to all the images in our dataset this file can be generated by a [python code](https://github.com/IITBRacing/Object-Detection-20---21-DV/blob/master/training/train_local/gen_train.py) given in this repository. 
  
  4. **DONOT forget to create a 'backup' folder in the root directory** that is in the darknet folder. This is the location where the trained weights file is generated and gets updated iteratively
  
  5. For training we use convolutional weights that are pre-trained on Imagenet. We use weights from the [darknet53](https://pjreddie.com/darknet/imagenet/#darknet53) model. You can just download the weights for the convolutional layers [here](https://pjreddie.com/media/files/darknet53.conv.74).
  ```
  wget https://pjreddie.com/media/files/darknet53.conv.74
  ```
  Download the pre-trained weights file in the root directory(darknet) by the command or the link given above
  
  6. With this we are all ready to start training, 
  ```
  /darknet detector train data/obj.data data/cfg/yolov3-custom.cfg darknet53.conv.74
  ```
   Use this command to start training
  
  7. After the training is complete u can see .weights files in the backup folder located in root directory
  
 ## Comments :
   I will be uploading all the files mentioned above in this repository
   
   
